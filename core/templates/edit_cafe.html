{% load crispy_forms_tags %}

{#        <!-- Button trigger modal -->#}
{#        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">#}
{#          Добавить новое блюдо#}
{#        </button>#}

{#<form hx-post="{{ request.path }}" hx-headers='{"X-CSRFToken":"{{ csrf_token }}"}' class="modal-content">#}

{#        <!-- Modal -->#}
{#        <div> {#  class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"> #}
          <div class="modal-dialog modal-content modal-xl" hx-target="this">
{#            <div class="modal-content">#}
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Новое заведение</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                    <form method="post" >
                        {% csrf_token %}
                        <p>
                            {{ form | crispy }}
{#                            {{ formset | crispy }}#}
                        </p>

                        <div id="imagerows">
                            {% for forms in formset %}
    {#                            <labe>{{ forms.name.label }}</labe>#}
                                <div id="imagerow">
                                {{ forms }}
                                </div>
                            {% endfor %}
                        </div>
                        <p>
                        </p>
                        <a href="#" id="add-image-button" class="btn btn-secondary add-images">Add More</a>

                        <input type="submit"
                               hx-post="{% url 'core:edit_cafe' cafe.id %}"
{#                               hx-post="/dishes/"#}
                               hx-trigger="click"
                {#               hx-on::after-request=" if(event.detail.successful) this.reset()"#}
                {#               hx-swap-oob="true"#}
                {#               hx-target="#dishes"#}
                               hx-target="#search-results"
                               hx-indicator=".htmx-indicator"
                        data-bs-dismiss="modal">
                    </form>

              </div>
              <div class="modal-footer">
{#                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>#}
{#                <button type="button" class="btn btn-primary">Save changes</button>#}
              </div>
{#            </div>#}
          </div>
{#        </div>#}
    </div>

<script>
    $(document).ready(function() {
        // when user clicks add more btn of images
      $('.add-images').click(function(ev) {
          ev.preventDefault();
          {#var count = $('#item-images').children().length;#}
          var tmplMarkup = $('#imagerow').html();
          {#var compiledTmpl = tmplMarkup.replace(/__prefix__/g, count);#}
          $('#imagerows').append(tmplMarkup);

          {#// update form count#}
          {#$('#id_images-TOTAL_FORMS').attr('value', count+1);#}
      });
  });
</script>